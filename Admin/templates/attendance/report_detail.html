{% extends "partials/layouts/main.html" %}
{% load static %}

{% include "partials/main.html" %}
{% block meta %}
{% with title="Report Details" %}
{% include "partials/title-meta.html" %}
{% endwith %}
{% endblock %}

{% block css %}
<link rel="stylesheet" href="/static/assets/libs/apexcharts/apexcharts.css">
{% endblock %}

{% block content %}
{% with title_sub="Attendance" title="Report Details" %}
{% include "partials/pagetitle.html" %}
{% endwith %}

<div class="row">
    <div class="col-xl-12">
        <div class="card">
            <div class="card-header d-flex align-items-center">
                <h5 class="card-title mb-0 flex-grow-1">{{ report.name }}</h5>
                <div class="flex-shrink-0">
                    <a href="{% url 'attendance:reports' %}" class="btn btn-light btn-sm">
                        <i class="ri-arrow-left-line align-bottom me-1"></i> Back to Reports
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="table-responsive">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <th class="ps-0" scope="row" width="200">Report ID:</th>
                                        <td class="text-muted">{{ report.id }}</td>
                                    </tr>
                                    <tr>
                                        <th class="ps-0" scope="row">Report Type:</th>
                                        <td>
                                            {% for type_value, type_label in report.REPORT_TYPES %}
                                                {% if report.report_type == type_value %}
                                                    <span class="badge bg-primary-subtle text-primary">{{ type_label }}</span>
                                                {% endif %}
                                            {% endfor %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="ps-0" scope="row">Date Range:</th>
                                        <td class="text-muted">{{ report.start_date|date:"M d, Y" }} to {{ report.end_date|date:"M d, Y" }}</td>
                                    </tr>
                                    <tr>
                                        <th class="ps-0" scope="row">Status:</th>
                                        <td>
                                            {% if report.status == "GENERATING" %}
                                            <span class="badge bg-warning">Generating</span>
                                            {% elif report.status == "COMPLETED" %}
                                            <span class="badge bg-success">Completed</span>
                                            {% elif report.status == "FAILED" %}
                                            <span class="badge bg-danger">Failed</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="table-responsive">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <th class="ps-0" scope="row" width="200">Generated By:</th>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0 me-2">
                                                    <div class="avatar-xs">
                                                        <div class="avatar-title bg-light text-primary rounded-circle">
                                                            {{ report.generated_by.first_name|slice:":1"|upper }}{{ report.generated_by.last_name|slice:":1"|upper }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    {{ report.generated_by.get_full_name }}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="ps-0" scope="row">Generated At:</th>
                                        <td class="text-muted">{{ report.generated_at|date:"M d, Y H:i:s" }}</td>
                                    </tr>
                                    <tr>
                                        <th class="ps-0" scope="row">Completed At:</th>
                                        <td class="text-muted">{{ report.completed_at|date:"M d, Y H:i:s"|default:"-" }}</td>
                                    </tr>
                                    <tr>
                                        <th class="ps-0" scope="row">Actions:</th>
                                        <td>
                                            {% if report.status == "COMPLETED" %}
                                            <div class="d-flex gap-2">
                                                <form method="post" action="{% url 'attendance:dashboard' %}">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="action" value="download_report">
                                                    <input type="hidden" name="report_id" value="{{ report.id }}">
                                                    <input type="hidden" name="format" value="xlsx">
                                                    <button type="submit" class="btn btn-sm btn-success">
                                                        <i class="ri-file-excel-line align-bottom me-1"></i> Excel
                                                    </button>
                                                </form>
                                                <form method="post" action="{% url 'attendance:dashboard' %}">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="action" value="download_report">
                                                    <input type="hidden" name="report_id" value="{{ report.id }}">
                                                    <input type="hidden" name="format" value="csv">
                                                    <button type="submit" class="btn btn-sm btn-info">
                                                        <i class="ri-file-text-line align-bottom me-1"></i> CSV
                                                    </button>
                                                </form>
                                            </div>
                                            {% else %}
                                            <span class="text-muted">Downloads available when completed</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                {% if report.status == "COMPLETED" %}
                <div class="mt-4">
                    <ul class="nav nav-tabs nav-tabs-custom nav-success mb-3" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#report-summary" role="tab">
                                Summary
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#report-details" role="tab">
                                Details
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#report-visualization" role="tab">
                                Visualization
                            </a>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane active" id="report-summary" role="tabpanel">
                            <div class="row">
                                {% if report.report_type == "DAILY" %}
                                <div class="col-md-4">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Report Summary</h5>
                                            <div class="table-responsive">
                                                <table class="table table-sm table-borderless mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Total Days:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.total_days }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Average Attendance:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.average_attendance }}%</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Attendance Trend</h5>
                                            <div id="dailyAttendanceChart" class="apex-charts" dir="ltr"></div>
                                        </div>
                                    </div>
                                </div>
                                {% elif report.report_type == "WEEKLY" %}
                                <div class="col-md-4">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Report Summary</h5>
                                            <div class="table-responsive">
                                                <table class="table table-sm table-borderless mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Total Weeks:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.total_weeks }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Average Attendance:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.average_attendance }}%</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Weekly Attendance Trend</h5>
                                            <div id="weeklyAttendanceChart" class="apex-charts" dir="ltr"></div>
                                        </div>
                                    </div>
                                </div>
                                {% elif report.report_type == "MONTHLY" %}
                                <div class="col-md-4">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Report Summary</h5>
                                            <div class="table-responsive">
                                                <table class="table table-sm table-borderless mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Total Months:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.total_months }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Average Attendance:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.average_attendance }}%</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Monthly Attendance Trend</h5>
                                            <div id="monthlyAttendanceChart" class="apex-charts" dir="ltr"></div>
                                        </div>
                                    </div>
                                </div>
                                {% elif report.report_type == "EMPLOYEE" %}
                                <div class="col-md-4">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Report Summary</h5>
                                            <div class="table-responsive">
                                                <table class="table table-sm table-borderless mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Total Employees:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.total_employees }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Average Attendance:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.average_attendance }}%</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Employee Attendance Comparison</h5>
                                            <div id="employeeAttendanceChart" class="apex-charts" dir="ltr"></div>
                                        </div>
                                    </div>
                                </div>
                                {% elif report.report_type == "DEPARTMENT" %}
                                <div class="col-md-4">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Report Summary</h5>
                                            <div class="table-responsive">
                                                <table class="table table-sm table-borderless mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Total Departments:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.total_departments }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Average Attendance:</th>
                                                            <td class="text-end fw-medium">{{ report.report_data.summary.average_attendance }}%</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Department Attendance Comparison</h5>
                                            <div id="departmentAttendanceChart" class="apex-charts" dir="ltr"></div>
                                        </div>
                                    </div>
                                </div>
                                {% elif report.report_type == "CUSTOM" %}
                                <div class="col-md-12">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Report Summary</h5>
                                            <div class="table-responsive">
                                                <table class="table table-sm table-borderless mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <th class="ps-0" scope="row" width="200">Date Range:</th>
                                                            <td class="fw-medium">{{ report.report_data.date_range.start_date }} to {{ report.report_data.date_range.end_date }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Total Days:</th>
                                                            <td class="fw-medium">{{ report.report_data.date_range.total_days }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th class="ps-0" scope="row">Total Employees:</th>
                                                            <td class="fw-medium">{{ report.report_data.attendance_data|length }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="tab-pane" id="report-details" role="tabpanel">
                            {% if report.report_type == "DAILY" %}
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">Date</th>
                                            <th scope="col">Weekday</th>
                                            <th scope="col">Total Employees</th>
                                            <th scope="col">Present</th>
                                            <th scope="col">Absent</th>
                                            <th scope="col">Late</th>
                                            <th scope="col">On Leave</th>
                                            <th scope="col">Attendance %</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for day in report.report_data.daily_data %}
                                        <tr>
                                            <td>{{ day.date }}</td>
                                            <td>{{ day.weekday }}</td>
                                            <td>{{ day.total_employees }}</td>
                                            <td>{{ day.present_count }}</td>
                                            <td>{{ day.absent_count }}</td>
                                            <td>{{ day.late_count }}</td>
                                            <td>{{ day.leave_count }}</td>
                                            <td>
                                                <div class="w-100">
                                                    <div class="d-flex justify-content-between align-items-center fs-13">
                                                        <p class="{% if day.attendance_percentage >= 90 %}text-success{% elif day.attendance_percentage >= 75 %}text-warning{% else %}text-danger{% endif %} mb-1">{{ day.attendance_percentage }}%</p>
                                                    </div>
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar {% if day.attendance_percentage >= 90 %}bg-success{% elif day.attendance_percentage >= 75 %}bg-warning{% else %}bg-danger{% endif %}" style="width: {{ day.attendance_percentage }}%"></div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% elif report.report_type == "WEEKLY" %}
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">Week</th>
                                            <th scope="col">Working Days</th>
                                            <th scope="col">Total Employees</th>
                                            <th scope="col">Present</th>
                                            <th scope="col">Absent</th>
                                            <th scope="col">Late</th>
                                            <th scope="col">On Leave</th>
                                            <th scope="col">Attendance %</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for week in report.report_data.weekly_data %}
                                        <tr>
                                            <td>{{ week.week_start }} to {{ week.week_end }}</td>
                                            <td>{{ week.working_days }}</td>
                                            <td>{{ week.total_employees }}</td>
                                            <td>{{ week.present_count }}</td>
                                            <td>{{ week.absent_count }}</td>
                                            <td>{{ week.late_count }}</td>
                                            <td>{{ week.leave_count }}</td>
                                            <td>
                                                <div class="w-100">
                                                    <div class="d-flex justify-content-between align-items-center fs-13">
                                                        <p class="{% if week.attendance_percentage >= 90 %}text-success{% elif week.attendance_percentage >= 75 %}text-warning{% else %}text-danger{% endif %} mb-1">{{ week.attendance_percentage }}%</p>
                                                    </div>
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar {% if week.attendance_percentage >= 90 %}bg-success{% elif week.attendance_percentage >= 75 %}bg-warning{% else %}bg-danger{% endif %}" style="width: {{ week.attendance_percentage }}%"></div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% elif report.report_type == "MONTHLY" %}
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">Month</th>
                                            <th scope="col">Year</th>
                                            <th scope="col">Working Days</th>
                                            <th scope="col">Total Employees</th>
                                            <th scope="col">Present</th>
                                            <th scope="col">Absent</th>
                                            <th scope="col">Late</th>
                                            <th scope="col">On Leave</th>
                                            <th scope="col">Attendance %</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for month in report.report_data.monthly_data %}
                                        <tr>
                                            <td>{{ month.month_name }}</td>
                                            <td>{{ month.year }}</td>
                                            <td>{{ month.working_days }}</td>
                                            <td>{{ month.total_employees }}</td>
                                            <td>{{ month.present_count }}</td>
                                            <td>{{ month.absent_count }}</td>
                                            <td>{{ month.late_count }}</td>
                                            <td>{{ month.leave_count }}</td>
                                            <td>
                                                <div class="w-100">
                                                    <div class="d-flex justify-content-between align-items-center fs-13">
                                                        <p class="{% if month.attendance_percentage >= 90 %}text-success{% elif month.attendance_percentage >= 75 %}text-warning{% else %}text-danger{% endif %} mb-1">{{ month.attendance_percentage }}%</p>
                                                    </div>
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar {% if month.attendance_percentage >= 90 %}bg-success{% elif month.attendance_percentage >= 75 %}bg-warning{% else %}bg-danger{% endif %}" style="width: {{ month.attendance_percentage }}%"></div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% elif report.report_type == "EMPLOYEE" %}
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">Employee Code</th>
                                            <th scope="col">Employee Name</th>
                                            <th scope="col">Department</th>
                                            <th scope="col">Total Days</th>
                                            <th scope="col">Present</th>
                                            <th scope="col">Absent</th>
                                            <th scope="col">Late</th>
                                            <th scope="col">On Leave</th>
                                            <th scope="col">Attendance %</th>
                                            <th scope="col">Work Hours</th>
                                            <th scope="col">Overtime Hours</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for emp in report.report_data.employee_data %}
                                        <tr>
                                            <td>{{ emp.employee_code }}</td>
                                            <td>{{ emp.employee_name }}</td>
                                            <td>{{ emp.department }}</td>
                                            <td>{{ emp.total_days }}</td>
                                            <td>{{ emp.present_count }}</td>
                                            <td>{{ emp.absent_count }}</td>
                                            <td>{{ emp.late_count }}</td>
                                            <td>{{ emp.leave_count }}</td>
                                            <td>
                                                <div class="w-100">
                                                    <div class="d-flex justify-content-between align-items-center fs-13">
                                                        <p class="{% if emp.attendance_percentage >= 90 %}text-success{% elif emp.attendance_percentage >= 75 %}text-warning{% else %}text-danger{% endif %} mb-1">{{ emp.attendance_percentage }}%</p>
                                                    </div>
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar {% if emp.attendance_percentage >= 90 %}bg-success{% elif emp.attendance_percentage >= 75 %}bg-warning{% else %}bg-danger{% endif %}" style="width: {{ emp.attendance_percentage }}%"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>{{ emp.total_work_hours }}</td>
                                            <td>{{ emp.total_overtime_hours }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% elif report.report_type == "DEPARTMENT" %}
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">Department</th>
                                            <th scope="col">Employee Count</th>
                                            <th scope="col">Total Days</th>
                                            <th scope="col">Present</th>
                                            <th scope="col">Absent</th>
                                            <th scope="col">Late</th>
                                            <th scope="col">On Leave</th>
                                            <th scope="col">Attendance %</th>
                                            <th scope="col">Work Hours</th>
                                            <th scope="col">Overtime Hours</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for dept in report.report_data.department_data %}
                                        <tr>
                                            <td>{{ dept.department_name }}</td>
                                            <td>{{ dept.employee_count }}</td>
                                            <td>{{ dept.total_days }}</td>
                                            <td>{{ dept.present_count }}</td>
                                            <td>{{ dept.absent_count }}</td>
                                            <td>{{ dept.late_count }}</td>
                                            <td>{{ dept.leave_count }}</td>
                                            <td>
                                                <div class="w-100">
                                                    <div class="d-flex justify-content-between align-items-center fs-13">
                                                        <p class="{% if dept.attendance_percentage >= 90 %}text-success{% elif dept.attendance_percentage >= 75 %}text-warning{% else %}text-danger{% endif %} mb-1">{{ dept.attendance_percentage }}%</p>
                                                    </div>
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar {% if dept.attendance_percentage >= 90 %}bg-success{% elif dept.attendance_percentage >= 75 %}bg-warning{% else %}bg-danger{% endif %}" style="width: {{ dept.attendance_percentage }}%"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>{{ dept.total_work_hours }}</td>
                                            <td>{{ dept.total_overtime_hours }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% elif report.report_type == "CUSTOM" %}
                            <div class="accordion" id="employeeAttendanceAccordion">
                                {% for employee in report.report_data.attendance_data %}
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                        <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="collapse{{ forloop.counter }}">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0 me-2">
                                                    <div class="avatar-xs">
                                                        <div class="avatar-title bg-light text-primary rounded-circle">
                                                            {{ employee.employee_name|slice:":1"|upper }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    {{ employee.employee_name }} ({{ employee.employee_code }})
                                                    <small class="text-muted ms-2">{{ employee.department }}</small>
                                                </div>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#employeeAttendanceAccordion">
                                        <div class="accordion-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover align-middle">
                                                    <thead class="table-light">
                                                        <tr>
                                                            <th scope="col">Date</th>
                                                            <th scope="col">Weekday</th>
                                                            <th scope="col">Status</th>
                                                            <th scope="col">First In</th>
                                                            <th scope="col">Last Out</th>
                                                            <th scope="col">Work Hours</th>
                                                            <th scope="col">Overtime Hours</th>
                                                            <th scope="col">Late Minutes</th>
                                                            <th scope="col">Early Departure</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for att in employee.attendance %}
                                                        <tr>
                                                            <td>{{ att.date }}</td>
                                                            <td>{{ att.weekday }}</td>
                                                            <td>
                                                                {% if att.status == "PRESENT" %}
                                                                <span class="badge bg-success-subtle text-success">Present</span>
                                                                {% elif att.status == "ABSENT" %}
                                                                <span class="badge bg-danger-subtle text-danger">Absent</span>
                                                                {% elif att.status == "LATE" %}
                                                                <span class="badge bg-warning-subtle text-warning">Late</span>
                                                                {% elif att.status == "EARLY_DEPARTURE" %}
                                                                <span class="badge bg-info-subtle text-info">Early Departure</span>
                                                                {% elif att.status == "LEAVE" %}
                                                                <span class="badge bg-primary-subtle text-primary">On Leave</span>
                                                                {% elif att.status == "HOLIDAY" %}
                                                                <span class="badge bg-secondary-subtle text-secondary">Holiday</span>
                                                                {% elif att.status == "HALF_DAY" %}
                                                                <span class="badge bg-dark-subtle text-dark">Half Day</span>
                                                                {% elif att.status == "NO_RECORD" %}
                                                                <span class="badge bg-light text-dark">No Record</span>
                                                                {% else %}
                                                                <span class="badge bg-light text-dark">{{ att.status }}</span>
                                                                {% endif %}
                                                            </td>
                                                            <td>{{ att.first_in|default:"-" }}</td>
                                                            <td>{{ att.last_out|default:"-" }}</td>
                                                            <td>{{ att.work_hours }}</td>
                                                            <td>{{ att.overtime_hours }}</td>
                                                            <td>{{ att.late_minutes }}</td>
                                                            <td>{{ att.early_departure_minutes }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="tab-pane" id="report-visualization" role="tabpanel">
                            {% if report.report_type == "DAILY" %}
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Daily Attendance Trend</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="dailyAttendanceTrendChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Attendance Distribution</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="dailyAttendancePieChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% elif report.report_type == "WEEKLY" %}
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Weekly Attendance Trend</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="weeklyAttendanceTrendChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Weekly Attendance Comparison</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="weeklyAttendanceBarChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% elif report.report_type == "MONTHLY" %}
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Monthly Attendance Trend</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="monthlyAttendanceTrendChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Monthly Attendance Comparison</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="monthlyAttendanceBarChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% elif report.report_type == "EMPLOYEE" %}
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Employee Attendance Comparison</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="employeeAttendanceBarChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Work Hours Comparison</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="employeeWorkHoursChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% elif report.report_type == "DEPARTMENT" %}
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Department Attendance Comparison</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="departmentAttendanceBarChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="card border">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Department Work Hours</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="departmentWorkHoursChart" class="apex-charts" dir="ltr" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% elif report.report_type == "CUSTOM" %}
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="alert alert-info">
                                        <i class="ri-information-line me-2"></i>
                                        Custom reports provide detailed daily attendance data for selected employees. Please check the Details tab for comprehensive information.
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="mt-4">
                    <div class="alert alert-warning">
                        <i class="ri-error-warning-line me-2"></i>
                        {% if report.status == "GENERATING" %}
                        This report is currently being generated. Please check back later.
                        {% elif report.status == "FAILED" %}
                        This report failed to generate. Please try creating a new report.
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="/static/assets/libs/apexcharts/apexcharts.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% if report.status == "COMPLETED" %}
        
        {% if report.report_type == "DAILY" %}
        // Daily Attendance Chart
        var dailyAttendanceOptions = {
            series: [{
                name: 'Attendance',
                data: [{% for day in report.report_data.daily_data %}{{ day.attendance_percentage }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                height: 350,
                type: 'line',
                zoom: {
                    enabled: false
                },
                toolbar: {
                    show: true
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            grid: {
                row: {
                    colors: ['#f3f3f3', 'transparent'],
                    opacity: 0.5
                },
            },
            xaxis: {
                categories: [{% for day in report.report_data.daily_data %}'{{ day.date }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                min: 0,
                max: 100,
                labels: {
                    formatter: function (val) {
                        return val.toFixed(0) + '%';
                    }
                }
            },
            colors: ['#0ab39c']
        };

        var dailyAttendanceChart = new ApexCharts(document.querySelector("#dailyAttendanceChart"), dailyAttendanceOptions);
        dailyAttendanceChart.render();
        
        // Daily Attendance Trend Chart
        var dailyAttendanceTrendOptions = {
            series: [{
                name: 'Present',
                data: [{% for day in report.report_data.daily_data %}{{ day.present_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Absent',
                data: [{% for day in report.report_data.daily_data %}{{ day.absent_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Late',
                data: [{% for day in report.report_data.daily_data %}{{ day.late_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'On Leave',
                data: [{% for day in report.report_data.daily_data %}{{ day.leave_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for day in report.report_data.daily_data %}'{{ day.date }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                title: {
                    text: 'Employees'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " employees"
                    }
                }
            },
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189']
        };

        var dailyAttendanceTrendChart = new ApexCharts(document.querySelector("#dailyAttendanceTrendChart"), dailyAttendanceTrendOptions);
        dailyAttendanceTrendChart.render();
        
        // Daily Attendance Pie Chart
        var totalPresent = 0;
        var totalAbsent = 0;
        var totalLate = 0;
        var totalLeave = 0;
        
        {% for day in report.report_data.daily_data %}
        totalPresent += {{ day.present_count }};
        totalAbsent += {{ day.absent_count }};
        totalLate += {{ day.late_count }};
        totalLeave += {{ day.leave_count }};
        {% endfor %}
        
        var dailyAttendancePieOptions = {
            series: [totalPresent, totalAbsent, totalLate, totalLeave],
            chart: {
                width: 380,
                type: 'pie',
            },
            labels: ['Present', 'Absent', 'Late', 'On Leave'],
            responsive: [{
                breakpoint: 480,
                options: {
                    chart: {
                        width: 200
                    },
                    legend: {
                        position: 'bottom'
                    }
                }
            }],
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189']
        };

        var dailyAttendancePieChart = new ApexCharts(document.querySelector("#dailyAttendancePieChart"), dailyAttendancePieOptions);
        dailyAttendancePieChart.render();
        
        {% elif report.report_type == "WEEKLY" %}
        // Weekly Attendance Chart
        var weeklyAttendanceOptions = {
            series: [{
                name: 'Attendance',
                data: [{% for week in report.report_data.weekly_data %}{{ week.attendance_percentage }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                height: 350,
                type: 'line',
                zoom: {
                    enabled: false
                },
                toolbar: {
                    show: true
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            grid: {
                row: {
                    colors: ['#f3f3f3', 'transparent'],
                    opacity: 0.5
                },
            },
            xaxis: {
                categories: [{% for week in report.report_data.weekly_data %}'Week {{ forloop.counter }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                min: 0,
                max: 100,
                labels: {
                    formatter: function (val) {
                        return val.toFixed(0) + '%';
                    }
                }
            },
            colors: ['#0ab39c']
        };

        var weeklyAttendanceChart = new ApexCharts(document.querySelector("#weeklyAttendanceChart"), weeklyAttendanceOptions);
        weeklyAttendanceChart.render();
        
        // Weekly Attendance Trend Chart
        var weeklyAttendanceTrendOptions = {
            series: [{
                name: 'Attendance %',
                data: [{% for week in report.report_data.weekly_data %}{{ week.attendance_percentage }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                height: 350,
                type: 'area',
                zoom: {
                    enabled: false
                },
                toolbar: {
                    show: true
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.3,
                }
            },
            xaxis: {
                categories: [{% for week in report.report_data.weekly_data %}'{{ week.week_start }} to {{ week.week_end }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                min: 0,
                max: 100,
                labels: {
                    formatter: function (val) {
                        return val.toFixed(0) + '%';
                    }
                }
            },
            colors: ['#0ab39c']
        };

        var weeklyAttendanceTrendChart = new ApexCharts(document.querySelector("#weeklyAttendanceTrendChart"), weeklyAttendanceTrendOptions);
        weeklyAttendanceTrendChart.render();
        
        // Weekly Attendance Bar Chart
        var weeklyAttendanceBarOptions = {
            series: [{
                name: 'Present',
                data: [{% for week in report.report_data.weekly_data %}{{ week.present_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Absent',
                data: [{% for week in report.report_data.weekly_data %}{{ week.absent_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Late',
                data: [{% for week in report.report_data.weekly_data %}{{ week.late_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'On Leave',
                data: [{% for week in report.report_data.weekly_data %}{{ week.leave_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                stacked: true,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for week in report.report_data.weekly_data %}'Week {{ forloop.counter }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                title: {
                    text: 'Employees'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " employees"
                    }
                }
            },
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189']
        };

        var weeklyAttendanceBarChart = new ApexCharts(document.querySelector("#weeklyAttendanceBarChart"), weeklyAttendanceBarOptions);
        weeklyAttendanceBarChart.render();
        {% elif report.report_type == "MONTHLY" %}
        // Monthly Attendance Chart
        var monthlyAttendanceOptions = {
            series: [{
                name: 'Attendance',
                data: [{% for month in report.report_data.monthly_data %}{{ month.attendance_percentage }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                height: 350,
                type: 'line',
                zoom: {
                    enabled: false
                },
                toolbar: {
                    show: true
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            grid: {
                row: {
                    colors: ['#f3f3f3', 'transparent'],
                    opacity: 0.5
                },
            },
            xaxis: {
                categories: [{% for month in report.report_data.monthly_data %}'{{ month.month_name }} {{ month.year }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                min: 0,
                max: 100,
                labels: {
                    formatter: function (val) {
                        return val.toFixed(0) + '%';
                    }
                }
            },
            colors: ['#0ab39c']
        };

        var monthlyAttendanceChart = new ApexCharts(document.querySelector("#monthlyAttendanceChart"), monthlyAttendanceOptions);
        monthlyAttendanceChart.render();
        
        // Monthly Attendance Trend Chart
        var monthlyAttendanceTrendOptions = {
            series: [{
                name: 'Attendance %',
                data: [{% for month in report.report_data.monthly_data %}{{ month.attendance_percentage }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                height: 350,
                type: 'area',
                zoom: {
                    enabled: false
                },
                toolbar: {
                    show: true
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.3,
                }
            },
            xaxis: {
                categories: [{% for month in report.report_data.monthly_data %}'{{ month.month_name }} {{ month.year }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                min: 0,
                max: 100,
                labels: {
                    formatter: function (val) {
                        return val.toFixed(0) + '%';
                    }
                }
            },
            colors: ['#0ab39c']
        };

        var monthlyAttendanceTrendChart = new ApexCharts(document.querySelector("#monthlyAttendanceTrendChart"), monthlyAttendanceTrendOptions);
        monthlyAttendanceTrendChart.render();
        
        // Monthly Attendance Bar Chart
        var monthlyAttendanceBarOptions = {
            series: [{
                name: 'Present',
                data: [{% for month in report.report_data.monthly_data %}{{ month.present_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Absent',
                data: [{% for month in report.report_data.monthly_data %}{{ month.absent_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Late',
                data: [{% for month in report.report_data.monthly_data %}{{ month.late_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'On Leave',
                data: [{% for month in report.report_data.monthly_data %}{{ month.leave_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                stacked: true,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for month in report.report_data.monthly_data %}'{{ month.month_name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                title: {
                    text: 'Employees'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " employees"
                    }
                }
            },
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189']
        };

        var monthlyAttendanceBarChart = new ApexCharts(document.querySelector("#monthlyAttendanceBarChart"), monthlyAttendanceBarOptions);
        monthlyAttendanceBarChart.render();
        
        {% elif report.report_type == "EMPLOYEE" %}
        // Employee Attendance Chart
        var employeeAttendanceOptions = {
            series: [{
                name: 'Attendance %',
                data: [{% for emp in report.report_data.employee_data %}{{ emp.attendance_percentage }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded',
                    distributed: true
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for emp in report.report_data.employee_data %}'{{ emp.employee_name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                min: 0,
                max: 100,
                title: {
                    text: 'Attendance %'
                },
                labels: {
                    formatter: function (val) {
                        return val.toFixed(0) + '%';
                    }
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val.toFixed(2) + "%"
                    }
                }
            },
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189', '#299cdb', '#6559cc']
        };

        var employeeAttendanceChart = new ApexCharts(document.querySelector("#employeeAttendanceChart"), employeeAttendanceOptions);
        employeeAttendanceChart.render();
        
        // Employee Attendance Bar Chart
        var employeeAttendanceBarOptions = {
            series: [{
                name: 'Present',
                data: [{% for emp in report.report_data.employee_data %}{{ emp.present_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Absent',
                data: [{% for emp in report.report_data.employee_data %}{{ emp.absent_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Late',
                data: [{% for emp in report.report_data.employee_data %}{{ emp.late_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'On Leave',
                data: [{% for emp in report.report_data.employee_data %}{{ emp.leave_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                stacked: true,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for emp in report.report_data.employee_data %}'{{ emp.employee_name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                title: {
                    text: 'Days'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " days"
                    }
                }
            },
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189']
        };

        var employeeAttendanceBarChart = new ApexCharts(document.querySelector("#employeeAttendanceBarChart"), employeeAttendanceBarOptions);
        employeeAttendanceBarChart.render();
        
        var employeeWorkHoursOptions = {
            series: [{
                name: 'Work Hours',
                data: [{% for emp in report.report_data.employee_data %}{{ emp.total_work_hours|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Overtime Hours',
                data: [{% for emp in report.report_data.employee_data %}{{ emp.total_overtime_hours|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for emp in report.report_data.employee_data %}'{{ emp.employee_name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                title: {
                    text: 'Hours'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val.toFixed(2) + " hours"
                    }
                }
            },
            colors: ['#0ab39c', '#f7b84b']
        };

        var employeeWorkHoursChart = new ApexCharts(document.querySelector("#employeeWorkHoursChart"), employeeWorkHoursOptions);
        employeeWorkHoursChart.render();
        {% elif report.report_type == "DEPARTMENT" %}
        var departmentAttendanceOptions = {
            series: [{
                name: 'Attendance %',
                data: [{% for dept in report.report_data.department_data %}{{ dept.attendance_percentage }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded',
                    distributed: true
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for dept in report.report_data.department_data %}'{{ dept.department_name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                min: 0,
                max: 100,
                title: {
                    text: 'Attendance %'
                },
                labels: {
                    formatter: function (val) {
                        return val.toFixed(0) + '%';
                    }
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val.toFixed(2) + "%"
                    }
                }
            },
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189', '#299cdb', '#6559cc']
        };

        var departmentAttendanceChart = new ApexCharts(document.querySelector("#departmentAttendanceChart"), departmentAttendanceOptions);
        departmentAttendanceChart.render();
        
        var departmentAttendanceBarOptions = {
            series: [{
                name: 'Present',
                data: [{% for dept in report.report_data.department_data %}{{ dept.present_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Absent',
                data: [{% for dept in report.report_data.department_data %}{{ dept.absent_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Late',
                data: [{% for dept in report.report_data.department_data %}{{ dept.late_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'On Leave',
                data: [{% for dept in report.report_data.department_data %}{{ dept.leave_count }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                stacked: true,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for dept in report.report_data.department_data %}'{{ dept.department_name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                title: {
                    text: 'Employees'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " employees"
                    }
                }
            },
            colors: ['#0ab39c', '#f06548', '#f7b84b', '#405189']
        };

        var departmentAttendanceBarChart = new ApexCharts(document.querySelector("#departmentAttendanceBarChart"), departmentAttendanceBarOptions);
        departmentAttendanceBarChart.render();

        var departmentWorkHoursOptions = {
            series: [{
                name: 'Work Hours',
                data: [{% for dept in report.report_data.department_data %}{{ dept.total_work_hours|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }, {
                name: 'Overtime Hours',
                data: [{% for dept in report.report_data.department_data %}{{ dept.total_overtime_hours|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}]
            }],
            chart: {
                type: 'bar',
                height: 350,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: [{% for dept in report.report_data.department_data %}'{{ dept.department_name }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            },
            yaxis: {
                title: {
                    text: 'Hours'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val.toFixed(2) + " hours"
                    }
                }
            },
            colors: ['#0ab39c', '#f7b84b']
        };

        var departmentWorkHoursChart = new ApexCharts(document.querySelector("#departmentWorkHoursChart"), departmentWorkHoursOptions);
        departmentWorkHoursChart.render();
        {% endif %}
        {% endif %}
    });
</script>
{% endblock %}






